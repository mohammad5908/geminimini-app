<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Store</title>
    
    <style>
        #crash-screen { display: none; padding: 20px; color: red; background: #000; position: fixed; inset: 0; z-index: 9999; font-family: monospace; direction: ltr; white-space: pre-wrap; }
        #init-loader { position: fixed; inset: 0; background: #000; color: #8b5cf6; display: flex; justify-content: center; align-items: center; z-index: 50; font-weight: bold; }
    </style>
</head>
<body style="background-color: #000; margin: 0;">

    <div id="crash-screen"></div>
    
    <div id="init-loader">CONNECTING TO TELEGRAM...</div>

    <script>
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('init-loader').style.display = 'none';
            const screen = document.getElementById('crash-screen');
            screen.style.display = 'block';
            screen.innerHTML += `âŒ ERROR:\n${msg}\nLine: ${line}\n\n`;
            return false;
        };
    </script>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">

    <script>
        try {
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: { sans: ['Vazirmatn', 'sans-serif'] },
                        colors: {
                            deep: '#050505',
                            glass: 'rgba(255, 255, 255, 0.08)',
                            primary: '#8b5cf6',
                            accent: '#ec4899',
                            gold: '#fbbf24'
                        },
                        animation: {
                            'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        }
                    }
                }
            }
        } catch (e) {
            console.error("Tailwind Config Error", e);
        }
    </script>

    <style>
        body { color: #fff; -webkit-tap-highlight-color: transparent; }
        .glass-panel {
            background: linear-gradient(180deg, rgba(30,30,30,0.7) 0%, rgba(10,10,10,0.9) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .btn-action {
            background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
            transition: transform 0.1s;
        }
        .btn-action:active { transform: scale(0.96); opacity: 0.9; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>

    <div id="app" class="hidden h-full">
        
        <div class="max-w-md mx-auto min-h-screen pb-24 px-5 pt-6 relative z-10">
            
            <header class="flex justify-between items-center mb-8">
                <div class="flex items-center gap-3">
                    <img :src="user.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-12 h-12 rounded-full border-2 border-white/10 bg-white/5">
                    <div>
                        <h1 class="font-bold text-lg leading-tight">{{ user.first_name }}</h1>
                        <p class="text-xs text-primary font-mono tracking-wider">ID: {{ user.id }}</p>
                    </div>
                </div>
                <button @click="toggleDebug" class="text-xs text-white/20 hover:text-white">v5.0</button>
            </header>

            <div v-if="debugMode" class="mb-4 p-2 bg-red-900/50 text-[10px] font-mono rounded border border-red-500 overflow-x-hidden">
                <p>Status: {{ status }}</p>
                <p>Params: {{ urlParams }}</p>
                <p>Telegram: {{ isTg }}</p>
            </div>

            <div @click="selectProduct('gemini_ultra_monthly_ready')" class="relative glass-panel rounded-3xl p-6 mb-6 overflow-hidden group cursor-pointer border border-primary/30">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-primary/20 rounded-full blur-[60px]"></div>
                
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-2">
                        <span class="bg-primary/20 text-primary text-[10px] font-bold px-2 py-1 rounded border border-primary/20">FLAGSHIP</span>
                        <i class="fa-solid fa-rocket text-2xl text-white/30"></i>
                    </div>
                    <h2 class="text-3xl font-black text-white mb-1">Gemini <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent">Ultra</span></h2>
                    <p class="text-xs text-white/60 mb-4">Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ØªØ±ÛŒÙ† Ù†Ø³Ø®Ù‡ Ú¯ÙˆÚ¯Ù„</p>
                    
                    <div class="flex items-center justify-between">
                        <span class="text-xl font-bold text-gold">{{ formatPrice(getPrice('gemini_ultra_monthly_ready')) }} <span class="text-xs text-white/50">ØªÙˆÙ…Ø§Ù†</span></span>
                        <div class="w-8 h-8 rounded-full bg-white text-black flex items-center justify-center shadow-lg group-active:scale-90 transition-transform">
                            <i class="fa-solid fa-arrow-left"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="p in regularProducts" :key="p.id" @click="selectProduct(p.id)"
                     class="glass-panel rounded-2xl p-4 flex items-center gap-4 cursor-pointer active:scale-[0.98] transition-transform">
                    
                    <div class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl bg-white/5 border border-white/5">
                        {{ p.emoji }}
                    </div>
                    
                    <div class="flex-1">
                        <h3 class="font-bold text-sm">{{ p.name }}</h3>
                        <p class="text-[10px] text-white/40 mt-0.5">{{ p.desc }}</p>
                    </div>
                    
                    <div class="text-left">
                        <div class="text-gold font-bold text-base">{{ formatPrice(p.price) }}</div>
                        <div class="text-[9px] text-white/30">ØªÙˆÙ…Ø§Ù†</div>
                    </div>
                </div>
            </div>

        </div>

        <div v-if="modal.show" class="fixed inset-0 z-50 flex items-end justify-center sm:items-center bg-black/90 backdrop-blur-sm p-4 animate-[fadeIn_0.2s]">
            <div class="w-full max-w-sm glass-panel rounded-3xl p-6 border-t border-white/20">
                
                <div class="text-center mb-6">
                    <div class="text-5xl mb-4">{{ modal.product.emoji }}</div>
                    <h3 class="text-xl font-bold">{{ modal.product.name }}</h3>
                    <p class="text-sm text-white/50 mt-1">{{ modal.product.desc }}</p>
                </div>

                <div class="flex justify-between items-center bg-white/5 p-4 rounded-xl mb-6">
                    <span class="text-sm text-white/70">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
                    <span class="text-xl font-bold text-gold">{{ formatPrice(modal.product.price) }} Øª</span>
                </div>

                <div class="flex gap-3">
                    <button @click="closeModal" class="flex-1 py-3.5 rounded-xl bg-white/10 font-bold text-sm text-white/70">Ø§Ù†ØµØ±Ø§Ù</button>
                    <button @click="sendDataToBot" class="flex-[2] py-3.5 rounded-xl btn-action text-white font-bold text-sm flex items-center justify-center gap-2">
                        <span v-if="!sending">ØªØ§ÛŒÛŒØ¯ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª</span>
                        <span v-else class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted, computed } = Vue;

        createApp({
            setup() {
                // ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§
                const user = ref({ first_name: 'Guest', id: '---' });
                const loading = ref(true);
                const sending = ref(false);
                const modal = ref({ show: false, product: {} });
                const debugMode = ref(false);
                const status = ref('Init...');
                const urlParams = ref('');
                const isTg = ref(false);

                // Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…Ø­ØµÙˆÙ„Ø§Øª (Ø³ÛŒÙ†Ú© Ø´Ø¯Ù‡ Ø¨Ø§ Ù¾Ø§ÛŒØªÙˆÙ†)
                const products = ref([
                    { id: 'gemini_pro_monthly_ready', name: 'Gemini Pro Ù…Ø§Ù‡Ø§Ù†Ù‡', desc: 'Ø§Ú©Ø§Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡ â€¢ ØªØ­ÙˆÛŒÙ„ Ø¢Ù†ÛŒ', price: 380000, emoji: 'ğŸ’' },
                    { id: 'gemini_pro_yearly_ready', name: 'Gemini Pro Ø³Ø§Ù„Ø§Ù†Ù‡', desc: 'Ø§Ú©Ø§Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡ â€¢ ÛŒÚ©Ø³Ø§Ù„Ù‡', price: 1280000, emoji: 'ğŸ‘‘' },
                    { id: 'gemini_pro_monthly_personal', name: 'Ø´Ø§Ø±Ú˜ Ø§ÛŒÙ…ÛŒÙ„ Ø´Ø®ØµÛŒ', desc: 'ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÛŒ Ø§Ú©Ø§Ù†Øª Ø´Ù…Ø§', price: 300000, emoji: 'ğŸ“§' },
                    { id: 'gemini_ultra_monthly_ready', name: 'Gemini Ultra', desc: 'Ù¾Ø±Ù‚Ø¯Ø±Øªâ€ŒØªØ±ÛŒÙ† Ù…Ø¯Ù„ Ú¯ÙˆÚ¯Ù„', price: 1850000, emoji: 'ğŸš€' }
                ]);

                // Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¹Ø§Ø¯ÛŒ (ØºÛŒØ± Ø§Ø² Ultra Ú©Ù‡ Hero Ø§Ø³Øª)
                const regularProducts = computed(() => products.value.filter(p => p.id !== 'gemini_ultra_monthly_ready'));

                // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
                onMounted(() => {
                    try {
                        const tg = window.Telegram.WebApp;
                        
                        // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ÛŒØ·
                        if (tg.initData) {
                            isTg.value = true;
                            status.value = "Telegram Connected";
                            tg.expand();
                            tg.setHeaderColor('#000000');
                            tg.setBackgroundColor('#000000');
                            
                            if (tg.initDataUnsafe?.user) {
                                user.value = tg.initDataUnsafe.user;
                            }
                        } else {
                            status.value = "Not inside Telegram";
                        }

                        // Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø§Ø² Ù„ÛŒÙ†Ú© (Ø§Ú¯Ø± Ø±Ø¨Ø§Øª ÙØ±Ø³ØªØ§Ø¯Ù‡ Ø¨Ø§Ø´Ø¯)
                        const params = new URLSearchParams(window.location.search);
                        urlParams.value = window.location.search;
                        products.value.forEach(p => {
                            if (params.has(p.id)) p.price = parseInt(params.get(p.id));
                        });

                        // Ù¾Ø§ÛŒØ§Ù† Ù„ÙˆØ¯ÛŒÙ†Ú¯
                        document.getElementById('init-loader').style.display = 'none';
                        document.getElementById('app').classList.remove('hidden');
                        loading.value = false;

                    } catch (e) {
                        alert("Critical Error: " + e.message);
                    }
                });

                // ØªÙˆØ§Ø¨Ø¹
                const formatPrice = (n) => Number(n).toLocaleString();
                const getPrice = (id) => products.value.find(p => p.id === id)?.price;
                
                const selectProduct = (id) => {
                    const p = products.value.find(x => x.id === id);
                    if (p) {
                        modal.value = { show: true, product: p };
                        if (window.Telegram.WebApp.HapticFeedback) 
                            window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                    }
                };

                const closeModal = () => modal.value.show = false;
                const toggleDebug = () => debugMode.value = !debugMode.value;

                // ØªØ§Ø¨Ø¹ Ø­ÛŒØ§ØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯ÛŒØªØ§
                const sendDataToBot = () => {
                    sending.value = true;
                    const tg = window.Telegram.WebApp;

                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('heavy');

                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ø¨Ù‡ØªØ±
                    setTimeout(() => {
                        try {
                            // ÙÙ‚Ø· Ø´Ù†Ø§Ø³Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒÙ… (ØªØ¶Ù…ÛŒÙ† Ú©Ø§Ø±Ú©Ø±Ø¯)
                            tg.sendData(modal.value.product.id);
                        } catch (e) {
                            alert("Send Error: " + e.message);
                            sending.value = false;
                        }
                    }, 500);
                };

                return {
                    user, loading, sending, modal, products, regularProducts, 
                    debugMode, status, urlParams, isTg,
                    formatPrice, getPrice, selectProduct, closeModal, sendDataToBot, toggleDebug
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
