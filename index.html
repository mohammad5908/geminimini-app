<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet"/>
    <style>
        body { font-family: 'Vazirmatn', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        .glass { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-active { background: rgba(255, 255, 255, 0.15); border-color: #a78bfa; box-shadow: 0 0 15px rgba(139, 92, 246, 0.3); }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-[#0f0c29] text-white min-h-screen flex flex-col items-center p-4 bg-gradient-to-br from-[#0f0c29] via-[#302b63] to-[#24243e]">
    <div id="app" class="w-full max-w-md pb-24 relative">
        
        <header class="text-center mb-6 pt-4 animate-pulse">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/8a/Google_Gemini_logo.svg" alt="Logo" class="w-16 mx-auto drop-shadow-lg mb-3">
            <h1 class="text-xl font-black">Ø¬Ù…Ù†Ø§ÛŒ <span class="text-purple-400">Ø³Ù†ØªØ±</span></h1>
            <p class="text-xs text-gray-400 mt-1" v-if="user">Ø³Ù„Ø§Ù… {{ user.first_name }} ðŸ‘‹</p>
        </header>

        <div class="space-y-3">
            <div v-for="p in products" :key="p.id" @click="select(p.id)" 
                 :class="['glass rounded-xl p-4 cursor-pointer transition-all duration-300 flex justify-between items-center', selected === p.id ? 'glass-active scale-[1.02]' : 'hover:bg-white/5']">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">{{ p.icon }}</span>
                    <div>
                        <h3 class="font-bold text-sm">{{ p.title }}</h3>
                        <p class="text-[10px] text-gray-300">{{ p.desc }}</p>
                    </div>
                </div>
                <div class="bg-purple-600/90 px-3 py-1 rounded-lg text-xs font-bold shadow">{{ p.price }} T</div>
            </div>
        </div>

        <div class="fixed bottom-5 left-0 right-0 px-4 w-full max-w-md mx-auto z-50">
            <button @click="submit" :disabled="loading || !selected"
                    class="w-full py-3.5 rounded-xl font-bold text-lg shadow-xl transition-all duration-200 flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed bg-gradient-to-r from-purple-600 to-indigo-600 hover:scale-[1.02] active:scale-95">
                <span v-if="loading" class="loader"></span>
                <span v-else>{{ btnText }}</span>
            </button>
        </div>

        <transition name="fade">
            <div v-if="toast.show" :class="toast.type === 'err' ? 'bg-red-600' : 'bg-green-600'" 
                 class="fixed top-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full shadow-2xl text-xs font-bold z-50 flex items-center gap-2 min-w-[200px] justify-center">
                <span>{{ toast.msg }}</span>
            </div>
        </transition>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        createApp({
            setup() {
                const tg = window.Telegram.WebApp;
                const user = ref(tg.initDataUnsafe?.user || null);
                const selected = ref(null);
                const loading = ref(false);
                const toast = ref({ show: false, msg: '', type: 'info' });

                const products = [
                    { id: 'monthly', title: 'Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ (Pro)', price: '300,000', desc: 'Ù…Ù†Ø§Ø³Ø¨ ØªØ³Øª Ùˆ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ù…Ø±Ù‡', icon: 'ðŸ’Ž' },
                    { id: 'yearly', title: 'Ø§Ø´ØªØ±Ø§Ú© Ø³Ø§Ù„Ø§Ù†Ù‡ (VIP)', price: '1,200,000', desc: 'Û±Ûµ Ù…Ø§Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ + Ø¨ÛŒÙ…Ù‡ ØªÙˆØ±Ù…', icon: 'â­ï¸' },
                    { id: 'ultra', title: 'Ø§Ø´ØªØ±Ø§Ú© Ø§ÙˆÙ„ØªØ±Ø§ (Ultra)', price: '1,800,000', desc: 'Ù‚Ø¯Ø±Øª ØµÙ†Ø¹ØªÛŒ Ùˆ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯', icon: 'â˜¢ï¸' }
                ];

                onMounted(() => {
                    tg.expand();
                    tg.MainButton.hide();
                    tg.setHeaderColor('#0f0c29');
                });

                const btnText = computed(() => selected.value ? 'ØªØ§ÛŒÛŒØ¯ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‡Ø§ÛŒÛŒ' : 'ÛŒÚ© Ù¾Ù„Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');

                const showToast = (msg, type = 'info') => {
                    toast.value = { show: true, msg, type };
                    setTimeout(() => toast.value.show = false, 3000);
                };

                const select = (id) => {
                    selected.value = id;
                    if (tg.HapticFeedback) tg.HapticFeedback.selectionChanged();
                };

                const submit = async () => {
                    if (!selected.value || loading.value) return;
                    loading.value = true;
                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

                    try {
                        // Validation
                        if (!['monthly', 'yearly', 'ultra'].includes(selected.value)) throw new Error("Ù¾Ù„Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±");

                        const payload = JSON.stringify({
                            action: "buy",
                            plan: selected.value,
                            user_id: user.value?.id,
                            ts: Date.now()
                        });

                        tg.sendData(payload);
                    } catch (e) {
                        console.error(e);
                        showToast('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø·. Ù…Ø¬Ø¯Ø¯ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯', 'err');
                        loading.value = false;
                    }
                };

                return { user, products, selected, loading, toast, btnText, select, submit };
            }
        }).mount('#app');
    </script>
</body>
</html>
