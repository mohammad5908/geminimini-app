<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#09090b">
    <title>Gemini Center | Super App</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Vazirmatn', 'sans-serif'] },
                    colors: {
                        void: '#09090b',
                        surface: '#18181b',
                        surface_light: '#27272a',
                        primary: '#8b5cf6', // Violet-500
                        primary_glow: 'rgba(139, 92, 246, 0.5)',
                        accent: '#ec4899', // Pink-500
                        gold: '#f59e0b',
                        success: '#10b981'
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-glow': 'pulseGlow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-8px)' } },
                        pulseGlow: { '0%, 100%': { opacity: 1, boxShadow: '0 0 20px rgba(139,92,246,0.2)' }, '50%': { opacity: .8, boxShadow: '0 0 40px rgba(139,92,246,0.4)' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        scaleIn: { '0%': { transform: 'scale(0.9)', opacity: 0 }, '100%': { transform: 'scale(1)', opacity: 1 } }
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS Reset & Advanced Styles */
        body { background-color: #09090b; color: #f4f4f5; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        
        /* Glassmorphism Classes */
        .glass {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-panel {
            background: linear-gradient(145deg, rgba(39, 39, 42, 0.4) 0%, rgba(24, 24, 27, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.3);
        }

        /* Gradient Text */
        .text-gradient { background: linear-gradient(to right, #a78bfa, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .text-gold { background: linear-gradient(to right, #fcd34d, #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Custom Scrollbar (Hidden) */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Utility Classes */
        .active-tab { color: #8b5cf6; position: relative; }
        .active-tab::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: #8b5cf6; border-radius: 50%; box-shadow: 0 0 10px #8b5cf6; }
        
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
        }
        .btn-primary:active { transform: scale(0.97); filter: brightness(1.1); }

        /* 3D Card Effect */
        .card-3d { transition: transform 0.1s ease; transform-style: preserve-3d; }
    </style>
</head>
<body class="antialiased min-h-screen pb-24 selection:bg-primary selection:text-white">

    <div id="app" class="relative z-10 max-w-lg mx-auto">
        
        <header class="fixed top-0 left-0 right-0 z-40 glass border-b border-white/5 px-5 py-4 max-w-lg mx-auto transition-all duration-300" :class="scrolled ? 'bg-void/90' : 'bg-transparent border-transparent'">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="relative cursor-pointer" @click="changeTab('profile')">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-primary to-accent rounded-full blur opacity-60"></div>
                        <img :src="user.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="relative w-10 h-10 rounded-full border border-surface object-cover">
                        <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-success border-2 border-void rounded-full"></div>
                    </div>
                    <div>
                        <h1 class="text-sm font-bold text-white leading-none mb-1">{{ user.first_name }}</h1>
                        <div class="flex items-center gap-1">
                            <span class="text-[10px] px-1.5 py-0.5 rounded bg-primary/20 text-primary border border-primary/20 font-medium">BASIC</span>
                            <span class="text-[10px] text-zinc-500">ID: {{ user.id }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <button @click="changeTab('cart')" class="relative w-10 h-10 rounded-full glass flex items-center justify-center text-zinc-400 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        <span v-if="cart.length > 0" class="absolute -top-1 -right-1 w-5 h-5 bg-accent text-white text-[10px] font-bold rounded-full flex items-center justify-center border border-void animate-scale-in">{{ cart.length }}</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="h-20"></div>

        <main class="px-5 space-y-6">

            <transition name="fade" mode="out-in">
                <div v-if="activeTab === 'home'" key="home" class="animate-slide-up">
                    
                    <div class="relative rounded-[32px] overflow-hidden p-6 mb-8 group cursor-pointer" @click="openProductModal('gemini_ultra_monthly_ready')">
                        <div class="absolute inset-0 bg-gradient-to-br from-primary via-purple-900 to-void opacity-80"></div>
                        <div class="absolute top-0 right-0 w-64 h-64 bg-accent/30 rounded-full blur-[80px] animate-pulse-slow"></div>
                        
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-4">
                                <span class="px-3 py-1 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-[10px] font-bold text-white tracking-widest">GEMINI 1.5</span>
                                <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center animate-float">
                                    <svg class="w-4 h-4 text-yellow-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                </div>
                            </div>
                            
                            <h2 class="text-3xl font-black text-white mb-2 leading-tight">Ultra <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-200 to-pink-200">Performance</span></h2>
                            <p class="text-xs text-purple-100/70 mb-6 max-w-[200px]">Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ØªØ±ÛŒÙ† Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ. ØªØ­Ù„ÛŒÙ„ ØªØµÙˆÛŒØ±ØŒ Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ Ùˆ Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§.</p>
                            
                            <div class="flex items-center gap-3">
                                <button class="px-5 py-2.5 rounded-xl bg-white text-primary font-bold text-xs shadow-lg active:scale-95 transition-transform">
                                    Ø®Ø±ÛŒØ¯ Ø¢Ù†ÛŒ
                                </button>
                                <span class="text-sm font-bold text-white">{{ formatPrice(getPrice('gemini_ultra_monthly_ready')) }} <span class="text-[10px] font-normal opacity-70">ØªÙˆÙ…Ø§Ù†</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3 overflow-x-auto pb-4 no-scrollbar">
                        <button v-for="cat in categories" :key="cat.id" @click="selectedCategory = cat.id"
                            class="px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap transition-all border"
                            :class="selectedCategory === cat.id ? 'bg-white text-black border-white' : 'bg-surface text-zinc-500 border-surface_light hover:border-zinc-600'">
                            {{ cat.name }}
                        </button>
                    </div>

                    <div class="grid grid-cols-1 gap-4">
                        <div v-for="product in filteredProducts" :key="product.id" 
                             class="glass-panel rounded-2xl p-4 flex items-center gap-4 cursor-pointer relative overflow-hidden group active:scale-[0.98] transition-transform duration-200"
                             @click="openProductModal(product.id)">
                            
                            <div class="w-16 h-16 rounded-xl flex items-center justify-center text-2xl shadow-inner border border-white/5" :class="product.color">
                                {{ product.emoji }}
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start mb-1">
                                    <h3 class="font-bold text-sm text-zinc-100 truncate">{{ product.name }}</h3>
                                    <span v-if="product.badge" class="px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider" :class="product.badgeColor">{{ product.badge }}</span>
                                </div>
                                <p class="text-[10px] text-zinc-500 line-clamp-1 mb-2">{{ product.desc }}</p>
                                <div class="flex justify-between items-end">
                                    <div class="text-gold font-bold text-base num-font">
                                        {{ formatPrice(product.price) }} <span class="text-[9px] text-zinc-600 font-normal">ØªÙˆÙ…Ø§Ù†</span>
                                    </div>
                                    <button @click.stop="addToCart(product)" class="w-8 h-8 rounded-full bg-surface_light border border-white/5 flex items-center justify-center text-zinc-400 hover:bg-primary hover:text-white transition-colors">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <transition name="fade" mode="out-in">
                <div v-if="activeTab === 'cart'" key="cart" class="animate-slide-up">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="w-1 h-6 bg-accent rounded-full"></span>
                        Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
                    </h2>

                    <div v-if="cart.length === 0" class="flex flex-col items-center justify-center py-20 text-center">
                        <div class="w-20 h-20 rounded-full bg-surface_light flex items-center justify-center mb-4 text-zinc-600">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        </div>
                        <p class="text-zinc-400 text-sm">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</p>
                        <button @click="activeTab = 'home'" class="mt-4 px-6 py-2 rounded-full border border-zinc-700 text-xs text-zinc-300 hover:bg-surface_light">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</button>
                    </div>

                    <div v-else class="space-y-4">
                        <div v-for="(item, index) in cart" :key="index" class="glass-panel rounded-2xl p-4 flex gap-4 items-center">
                            <div class="w-14 h-14 rounded-xl bg-surface_light flex items-center justify-center text-xl">
                                {{ item.emoji }}
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-sm text-zinc-200">{{ item.name }}</h3>
                                <p class="text-gold text-xs mt-1 font-bold">{{ formatPrice(item.price) }} Øª</p>
                            </div>
                            <button @click="removeFromCart(index)" class="w-8 h-8 rounded-full bg-red-500/10 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>

                        <div class="border-t border-white/5 pt-4 mt-4">
                            <div class="flex justify-between text-sm mb-2 text-zinc-400"><span>ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ù„Ø§Ù…</span><span>{{ cart.length }}</span></div>
                            <div class="flex justify-between text-lg font-bold text-white mt-4"><span>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</span><span>{{ formatPrice(cartTotal) }} ØªÙˆÙ…Ø§Ù†</span></div>
                        </div>

                        <button @click="checkout" class="w-full py-4 rounded-xl btn-primary text-white font-bold text-sm flex items-center justify-center gap-2 mt-4">
                            <span>Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù‡Ø§ÛŒÛŒ</span>
                            <svg v-if="loading" class="animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <svg v-else class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        </button>
                    </div>
                </div>
            </transition>

            <transition name="fade" mode="out-in">
                <div v-if="activeTab === 'profile'" key="profile" class="animate-slide-up">
                    <div class="glass-panel rounded-3xl p-6 text-center mb-6">
                        <div class="w-20 h-20 mx-auto rounded-full bg-surface p-1 mb-4 relative">
                            <img :src="user.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="w-full h-full rounded-full object-cover">
                            <div class="absolute bottom-0 right-0 bg-primary text-white text-[10px] px-2 py-0.5 rounded-full border border-surface">PRO</div>
                        </div>
                        <h2 class="text-xl font-bold">{{ user.first_name }} {{ user.last_name }}</h2>
                        <p class="text-zinc-500 text-xs mt-1">ID: {{ user.id }}</p>
                        
                        <div class="grid grid-cols-2 gap-3 mt-6">
                            <div class="bg-surface rounded-xl p-3">
                                <div class="text-zinc-400 text-[10px]">Ø³ÙØ§Ø±Ø´Ø§Øª</div>
                                <div class="text-lg font-bold text-white">0</div>
                            </div>
                            <div class="bg-surface rounded-xl p-3">
                                <div class="text-zinc-400 text-[10px]">Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
                                <div class="text-lg font-bold text-gold">0 <span class="text-[10px]">ØªÙˆÙ…Ø§Ù†</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <button class="w-full glass-panel rounded-xl p-4 flex items-center justify-between hover:bg-surface_light transition-colors">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-blue-500/10 text-blue-500 flex items-center justify-center"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></div>
                                <span class="text-sm">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</span>
                            </div>
                            <svg class="w-4 h-4 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        <button class="w-full glass-panel rounded-xl p-4 flex items-center justify-center text-zinc-500 text-xs mt-8">
                            Version 5.0.0 (Titanium)
                        </button>
                    </div>
                </div>
            </transition>

        </main>

        <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 pb-6 pt-2 px-6 z-50">
            <div class="flex justify-between items-center max-w-lg mx-auto">
                <button @click="changeTab('home')" class="flex flex-col items-center gap-1 w-16 transition-all duration-300" :class="activeTab === 'home' ? 'text-primary -translate-y-2' : 'text-zinc-500'">
                    <div class="text-2xl transition-transform" :class="activeTab === 'home' ? 'scale-110 drop-shadow-[0_0_10px_rgba(139,92,246,0.5)]' : ''">
                        <i class="fa-solid fa-store"></i>
                    </div>
                    <span class="text-[9px] font-bold" :class="activeTab === 'home' ? 'opacity-100' : 'opacity-0'">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span>
                </button>
                
                <button @click="changeTab('cart')" class="flex flex-col items-center gap-1 w-16 transition-all duration-300" :class="activeTab === 'cart' ? 'text-primary -translate-y-2' : 'text-zinc-500'">
                    <div class="relative text-2xl transition-transform" :class="activeTab === 'cart' ? 'scale-110 drop-shadow-[0_0_10px_rgba(139,92,246,0.5)]' : ''">
                        <i class="fa-solid fa-basket-shopping"></i>
                        <span v-if="cart.length" class="absolute -top-1 -right-1 w-2 h-2 bg-accent rounded-full animate-ping"></span>
                    </div>
                    <span class="text-[9px] font-bold" :class="activeTab === 'cart' ? 'opacity-100' : 'opacity-0'">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</span>
                </button>
                
                <button @click="changeTab('profile')" class="flex flex-col items-center gap-1 w-16 transition-all duration-300" :class="activeTab === 'profile' ? 'text-primary -translate-y-2' : 'text-zinc-500'">
                    <div class="text-2xl transition-transform" :class="activeTab === 'profile' ? 'scale-110 drop-shadow-[0_0_10px_rgba(139,92,246,0.5)]' : ''">
                        <i class="fa-solid fa-user-astronaut"></i>
                    </div>
                    <span class="text-[9px] font-bold" :class="activeTab === 'profile' ? 'opacity-100' : 'opacity-0'">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
                </button>
            </div>
        </nav>

        <transition name="fade">
            <div v-if="modal.show" class="fixed inset-0 z-[60] flex items-end sm:items-center justify-center" @click.self="closeModal">
                <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity"></div>
                <div class="relative w-full max-w-lg bg-surface border-t border-white/10 rounded-t-[32px] sm:rounded-[32px] p-6 animate-slide-up shadow-2xl">
                    <div class="w-12 h-1.5 bg-zinc-700 rounded-full mx-auto mb-6"></div>
                    
                    <div class="text-center mb-6">
                        <div class="w-24 h-24 mx-auto rounded-2xl bg-surface_light flex items-center justify-center text-5xl mb-4 shadow-lg border border-white/5">
                            {{ modal.product.emoji }}
                        </div>
                        <h2 class="text-2xl font-black text-white">{{ modal.product.name }}</h2>
                        <div class="inline-block mt-2 px-3 py-1 rounded bg-white/5 text-[10px] text-zinc-400 border border-white/5">{{ modal.product.desc }}</div>
                    </div>

                    <div class="space-y-3 mb-8">
                        <div class="flex items-center gap-3 p-3 rounded-xl bg-black/20 border border-white/5">
                            <div class="w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center text-green-500"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                            <span class="text-sm text-zinc-300">ØªØ­ÙˆÛŒÙ„ Ø¢Ù†ÛŒ Ùˆ Ø®ÙˆØ¯Ú©Ø§Ø±</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 rounded-xl bg-black/20 border border-white/5">
                            <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                            <span class="text-sm text-zinc-300">Ú¯Ø§Ø±Ø§Ù†ØªÛŒ ØªØ§ Ø¢Ø®Ø±ÛŒÙ† Ø±ÙˆØ²</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-between gap-4">
                        <div class="text-2xl font-black text-gold num-font">{{ formatPrice(modal.product.price) }} <span class="text-xs text-zinc-500 font-normal">Øª</span></div>
                        <button @click="buyDirectFromModal" class="flex-1 py-4 rounded-xl btn-primary text-white font-bold text-sm shadow-xl">Ø®Ø±ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…</button>
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="toast.show" class="fixed top-6 left-1/2 -translate-x-1/2 z-[70] flex items-center gap-3 px-4 py-2.5 rounded-full glass border border-primary/30 shadow-2xl shadow-primary/20">
                <div class="w-2 h-2 rounded-full bg-success animate-pulse"></div>
                <span class="text-xs font-bold text-white">{{ toast.message }}</span>
            </div>
        </transition>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const tg = window.Telegram.WebApp;
                const activeTab = ref('home');
                const selectedCategory = ref('all');
                const loading = ref(false);
                const scrolled = ref(false);
                const user = ref({ first_name: 'Guest', id: '---' });
                const cart = ref([]);
                const toast = ref({ show: false, message: '' });
                const modal = ref({ show: false, product: {} });

                // Product Database (Synced with Python)
                const products = ref([
                    { id: 'gemini_pro_monthly_ready', name: 'Gemini Pro Ù…Ø§Ù‡Ø§Ù†Ù‡', desc: 'Ø§Ú©Ø§Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡ â€¢ Û³Û° Ø±ÙˆØ²Ù‡', price: 380000, emoji: 'ğŸ’', category: 'ready', badge: 'POPULAR', badgeColor: 'bg-primary/20 text-primary', color: 'bg-primary/10 text-primary' },
                    { id: 'gemini_pro_yearly_ready', name: 'Gemini Pro Ø³Ø§Ù„Ø§Ù†Ù‡', desc: 'Ø§Ú©Ø§Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡ â€¢ Û³Û¶Ûµ Ø±ÙˆØ²Ù‡', price: 1280000, emoji: 'ğŸ‘‘', category: 'ready', badge: '-30%', badgeColor: 'bg-accent/20 text-accent', color: 'bg-accent/10 text-accent' },
                    { id: 'gemini_pro_monthly_personal', name: 'Ø´Ø§Ø±Ú˜ Ø§ÛŒÙ…ÛŒÙ„ Ø´Ø®ØµÛŒ', desc: 'ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÛŒ Ø§Ú©Ø§Ù†Øª Ø´Ù…Ø§', price: 300000, emoji: 'ğŸ“§', category: 'personal', badge: 'LEGAL', badgeColor: 'bg-blue-500/20 text-blue-400', color: 'bg-blue-500/10 text-blue-400' },
                    { id: 'gemini_ultra_monthly_ready', name: 'Gemini Ultra', desc: 'Ù¾Ø±Ù‚Ø¯Ø±Øªâ€ŒØªØ±ÛŒÙ† Ù…Ø¯Ù„ Ú¯ÙˆÚ¯Ù„', price: 1850000, emoji: 'ğŸš€', category: 'ready', badge: 'NEW', badgeColor: 'bg-gold/20 text-gold', color: 'bg-gold/10 text-gold' }
                ]);

                const categories = [
                    { id: 'all', name: 'Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª' },
                    { id: 'ready', name: 'Ø§Ú©Ø§Ù†Øª Ø¢Ù…Ø§Ø¯Ù‡' },
                    { id: 'personal', name: 'Ø´Ø®ØµÛŒ' }
                ];

                // Computed
                const filteredProducts = computed(() => {
                    if (selectedCategory.value === 'all') return products.value.filter(p => p.id !== 'gemini_ultra_monthly_ready'); // Remove ultra from list since it's hero
                    return products.value.filter(p => p.category === selectedCategory.value && p.id !== 'gemini_ultra_monthly_ready');
                });

                const cartTotal = computed(() => cart.value.reduce((sum, item) => sum + item.price, 0));

                // Helper: Dynamic Pricing from URL
                const updatePrices = () => {
                    const params = new URLSearchParams(window.location.search);
                    products.value.forEach(p => {
                        // Looks for param like ?gemini_pro_monthly_ready=400000
                        if (params.has(p.id)) p.price = parseInt(params.get(p.id));
                    });
                };

                // Helper: Haptic Feedback
                const haptic = (style = 'medium') => {
                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred(style);
                };

                // Actions
                const changeTab = (tab) => {
                    haptic('light');
                    activeTab.value = tab;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };

                const addToCart = (product) => {
                    haptic('medium');
                    cart.value.push(product);
                    showToast('Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                };

                const removeFromCart = (index) => {
                    haptic('light');
                    cart.value.splice(index, 1);
                };

                const openProductModal = (id) => {
                    haptic('light');
                    const p = products.value.find(x => x.id === id);
                    if (p) {
                        modal.value.product = p;
                        modal.value.show = true;
                    }
                };

                const closeModal = () => modal.value.show = false;

                const showToast = (msg) => {
                    toast.value = { show: true, message: msg };
                    setTimeout(() => toast.value.show = false, 2500);
                };

                // BUY LOGIC (CRITICAL)
                const buyDirectFromModal = () => {
                    checkoutSingle(modal.value.product.id);
                };

                const checkoutSingle = (id) => {
                    haptic('heavy');
                    loading.value = true;
                    setTimeout(() => {
                        // Sends SIMPLE STRING to Python (Perfect Compatibility)
                        tg.sendData(id);
                    }, 500);
                };

                const checkout = () => {
                    if (cart.value.length === 0) return;
                    haptic('heavy');
                    loading.value = true;
                    
                    // Logic: If cart has items, we send the ID of the first item OR a JSON.
                    // To keep compatibility with your Python "handle_webapp_data" which expects a string ID first:
                    // We will send the ID of the first item as a fallback for now, 
                    // OR better: Send a JSON string if you updated the python code as we discussed.
                    // Assuming you have the smart python handler:
                    
                    const payload = JSON.stringify({
                        action: 'cart_checkout',
                        items: cart.value.map(i => i.id),
                        total: cartTotal.value
                    });
                    
                    // If you haven't updated python to parse JSON, this will fail.
                    // Fallback to sending the first item's ID for safety:
                    const safePayload = cart.value[0].id; 
                    
                    setTimeout(() => {
                        tg.sendData(payload); // Try sending JSON (Python needs Smart Gateway)
                    }, 600);
                };

                const formatPrice = (p) => p.toLocaleString();

                // Lifecycle
                onMounted(() => {
                    tg.expand();
                    tg.setHeaderColor('#09090b');
                    tg.setBackgroundColor('#09090b');
                    tg.enableClosingConfirmation();
                    
                    if (tg.initDataUnsafe?.user) user.value = tg.initDataUnsafe.user;
                    
                    updatePrices();
                    
                    // Scroll Listener
                    window.addEventListener('scroll', () => {
                        scrolled.value = window.scrollY > 20;
                    });
                });

                return {
                    activeTab, selectedCategory, loading, scrolled, user, cart, toast, modal,
                    categories, filteredProducts, cartTotal,
                    changeTab, addToCart, removeFromCart, openProductModal, closeModal, 
                    buyDirectFromModal, checkout, getPrice: (id) => products.value.find(p=>p.id===id)?.price,
                    formatPrice
                };
            }
        }).mount('#app');
    </script>

    <style>
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</body>
</html>
